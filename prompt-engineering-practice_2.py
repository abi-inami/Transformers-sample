from transformers import pipeline

generator = pipeline(
    "text2text-generation",
    model="sonoisa/t5-base-japanese-adapt",
)

def generate(prompt: str):
    return generator(
        prompt,
        max_new_tokens=14,           # 短く制限して不要な続きを防止
        min_new_tokens=8,            # 最低限の長さ
        num_beams=10,                # 精度重視
        early_stopping=True,         # EOSで終了
        no_repeat_ngram_size=4,      # より強い繰り返し防止
        repetition_penalty=2.0,      # パターン続きを強く抑制
        length_penalty=0.5,          # 短い出力を強く促進
    )[0]["generated_text"]

# Zero-shot
print("=" * 60)
print("Zero-shot（例なし）")
print("=" * 60)
prompt = """
タスク: お礼メール文生成

指示:
以下の状況に応じた丁寧なお礼のメール文を生成してください。
1文で簡潔に記述してください。

状況: 取引先からプレゼントをいただいた
お礼文:
"""
print("結果: " + generate(prompt))
print()

# Few-shot (3-shot)
print("=" * 60)
print("Few-shot（例3つ）")
print("=" * 60)
prompt = """
タスク: お礼メール文生成

指示:
以下の状況に応じた丁寧なお礼のメール文を生成してください。
1文で簡潔に記述してください。

例1:
状況: 会議に参加していただいた
お礼文: 本日はご多忙のところ、会議にご参加いただき誠にありがとうございました。

例2:
状況: 資料を送っていただいた
お礼文: 貴重な資料をお送りいただき、心より感謝申し上げます。

例3:
状況: アドバイスをいただいた
お礼文: 的確なアドバイスをいただき、大変参考になりました。

生成対象:
状況: 取引先からプレゼントをいただいた
お礼文:
"""
print("結果: " + generate(prompt))
print()

# Five-shot (5-shot)
print("=" * 60)
print("Five-shot（例5つ）")
print("=" * 60)
prompt = """
タスク: お礼メール文生成

指示:
以下の状況に応じた丁寧なお礼のメール文を生成してください。
1文で簡潔に記述してください。

例1:
状況: 会議に参加していただいた
お礼文: 本日はご多忙のところ、会議にご参加いただき誠にありがとうございました。

例2:
状況: 資料を送っていただいた
お礼文: 貴重な資料をお送りいただき、心より感謝申し上げます。

例3:
状況: アドバイスをいただいた
お礼文: 的確なアドバイスをいただき、大変参考になりました。

例4:
状況: プロジェクトに協力していただいた
お礼文: プロジェクトへのご協力、誠にありがとうございました。

例5:
状況: セミナーに登壇していただいた
お礼文: 素晴らしいご講演をいただき、参加者一同感銘を受けました。

生成対象:
状況: 取引先からプレゼントをいただいた
お礼文:
"""
print("結果: " + generate(prompt))
print()

# Eight-shot (8-shot)
print("=" * 60)
print("Eight-shot（例8つ）")
print("=" * 60)
prompt = """
タスク: お礼メール文生成

指示:
以下の状況に応じた丁寧なお礼のメール文を生成してください。
1文で簡潔に記述してください。

例1:
状況: 会議に参加していただいた
お礼文: 本日はご多忙のところ、会議にご参加いただき誠にありがとうございました。

例2:
状況: 資料を送っていただいた
お礼文: 貴重な資料をお送りいただき、心より感謝申し上げます。

例3:
状況: アドバイスをいただいた
お礼文: 的確なアドバイスをいただき、大変参考になりました。

例4:
状況: プロジェクトに協力していただいた
お礼文: プロジェクトへのご協力、誠にありがとうございました。

例5:
状況: セミナーに登壇していただいた
お礼文: 素晴らしいご講演をいただき、参加者一同感銘を受けました。

例6:
状況: 問題解決に尽力していただいた
お礼文: 迅速なご対応により、問題を解決していただき感謝いたします。

例7:
状況: 食事をご馳走していただいた
お礼文: 昨日は美味しいお食事をご馳走いただき、ありがとうございました。

例8:
状況: 推薦状を書いていただいた
お礼文: 推薦状をお書きいただき、心より御礼申し上げます。

生成対象:
状況: 取引先からプレゼントをいただいた
お礼文:
"""
print("結果: " + generate(prompt))
print()

# Ten-shot (10-shot)
print("=" * 60)
print("Ten-shot（例10個）")
print("=" * 60)
prompt = """
タスク: お礼メール文生成

指示:
以下の状況に応じた丁寧なお礼のメール文を生成してください。
1文で簡潔に記述してください。

例1:
状況: 会議に参加していただいた
お礼文: 本日はご多忙のところ、会議にご参加いただき誠にありがとうございました。

例2:
状況: 資料を送っていただいた
お礼文: 貴重な資料をお送りいただき、心より感謝申し上げます。

例3:
状況: アドバイスをいただいた
お礼文: 的確なアドバイスをいただき、大変参考になりました。

例4:
状況: プロジェクトに協力していただいた
お礼文: プロジェクトへのご協力、誠にありがとうございました。

例5:
状況: セミナーに登壇していただいた
お礼文: 素晴らしいご講演をいただき、参加者一同感銘を受けました。

例6:
状況: 問題解決に尽力していただいた
お礼文: 迅速なご対応により、問題を解決していただき感謝いたします。

例7:
状況: 食事をご馳走していただいた
お礼文: 昨日は美味しいお食事をご馳走いただき、ありがとうございました。

例8:
状況: 推薦状を書いていただいた
お礼文: 推薦状をお書きいただき、心より御礼申し上げます。

例9:
状況: 視察を受け入れていただいた
お礼文: 貴重なお時間をいただき、施設をご案内いただきありがとうございました。

例10:
状況: 契約を締結していただいた
お礼文: この度は弊社との契約をご決定いただき、深く感謝申し上げます。

生成対象:
状況: 取引先からプレゼントをいただいた
お礼文:
"""
print("結果: " + generate(prompt))
print()

# Twelve-shot (12-shot)
print("=" * 60)
print("Twelve-shot（例12個）")
print("=" * 60)
prompt = """
タスク: お礼メール文生成

指示:
以下の状況に応じた丁寧なお礼のメール文を生成してください。
1文で簡潔に記述してください。

例1:
状況: 会議に参加していただいた
お礼文: 本日はご多忙のところ、会議にご参加いただき誠にありがとうございました。

例2:
状況: 資料を送っていただいた
お礼文: 貴重な資料をお送りいただき、心より感謝申し上げます。

例3:
状況: アドバイスをいただいた
お礼文: 的確なアドバイスをいただき、大変参考になりました。

例4:
状況: プロジェクトに協力していただいた
お礼文: プロジェクトへのご協力、誠にありがとうございました。

例5:
状況: セミナーに登壇していただいた
お礼文: 素晴らしいご講演をいただき、参加者一同感銘を受けました。

例6:
状況: 問題解決に尽力していただいた
お礼文: 迅速なご対応により、問題を解決していただき感謝いたします。

例7:
状況: 食事をご馳走していただいた
お礼文: 昨日は美味しいお食事をご馳走いただき、ありがとうございました。

例8:
状況: 推薦状を書いていただいた
お礼文: 推薦状をお書きいただき、心より御礼申し上げます。

例9:
状況: 視察を受け入れていただいた
お礼文: 貴重なお時間をいただき、施設をご案内いただきありがとうございました。

例10:
状況: 契約を締結していただいた
お礼文: この度は弊社との契約をご決定いただき、深く感謝申し上げます。

例11:
状況: インタビューに応じていただいた
お礼文: 貴重なお話を聞かせていただき、大変勉強になりました。

例12:
状況: 製品のデモンストレーションをしていただいた
お礼文: 詳細な製品説明をいただき、理解が深まりました。

生成対象:
状況: 取引先からプレゼントをいただいた
お礼文:
"""
print("結果: " + generate(prompt))
print()
