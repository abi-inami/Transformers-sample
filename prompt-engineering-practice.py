from transformers import pipeline

generator = pipeline(
    "text2text-generation",
    model="sonoisa/t5-base-japanese-adapt",
)

def generate(prompt: str):
    return generator(
        prompt,
        max_new_tokens=3,            # 必要トークンは最小限
        min_new_tokens=1,            # 最低1トークン生成
        num_beams=8,                 # 精度重視でビーム数を増やす
        early_stopping=True,         # EOSで即終了
        no_repeat_ngram_size=2,      # 繰り返し防止
        repetition_penalty=2.0,      # 強いペナルティ（繰り返しを強く抑制）
        length_penalty=0.8,          # 軽めの短縮促進
    )[0]["generated_text"]

# Zero-shot
print("=" * 60)
print("Zero-shot（例なし）")
print("=" * 60)
prompt = """
タスク: 感情分析

指示:
以下の文章を読み、その感情を判定してください。
必ず「ポジティブ」「ネガティブ」「ニュートラル」のいずれか1つの単語のみで答えてください。

文章:
このレストランの料理は最高に美味しかった

回答:
"""
print("結果: " + generate(prompt))
print()

# Few-shot
print("=" * 60)
print("Few-shot（3つの例あり）")
print("=" * 60)
prompt = """
タスク: 感情分析

指示:
以下の文章を読み、その感情を判定してください。
必ず「ポジティブ」「ネガティブ」「ニュートラル」のいずれか1つの単語のみで答えてください。
以下の例を参考にしてください。

例1:
文章: シェフの作るデザートは絶品で感動した
感情: ポジティブ

例2:
文章: 料理が冷めていて味も薄くて残念だった
感情: ネガティブ

例3:
文章: 味は普通だが値段相応だと思う
感情: ニュートラル

判定対象:
文章: このレストランの料理は最高に美味しかった
感情:
"""
print("結果: " + generate(prompt))
print()

# Five-shot（5つの例）
print("=" * 60)
print("Five-shot（5つの例あり）")
print("=" * 60)
prompt = """
タスク: 感情分析

指示:
以下の文章を読み、その感情を判定してください。
必ず「ポジティブ」「ネガティブ」「ニュートラル」のいずれか1つの単語のみで答えてください。
以下の例を参考にしてください。

例1:
文章: シェフの作るデザートは絶品で感動した
感情: ポジティブ

例2:
文章: 料理が冷めていて味も薄くて残念だった
感情: ネガティブ

例3:
文章: 味は普通だが値段相応だと思う
感情: ニュートラル

例4:
文章: サービスも料理も素晴らしく最高の体験だった
感情: ポジティブ

例5:
文章: 待ち時間が長すぎて二度と行きたくない
感情: ネガティブ

判定対象:
文章: このレストランの料理は最高に美味しかった
感情:
"""
print("結果: " + generate(prompt))
print()

# Six-shot（6つの例）
print("=" * 60)
print("Six-shot（6つの例あり）")
print("=" * 60)
prompt = """
タスク: 感情分析

指示:
以下の文章を読み、その感情を判定してください。
必ず「ポジティブ」「ネガティブ」「ニュートラル」のいずれか1つの単語のみで答えてください。
以下の例を参考にしてください。

例1:
文章: シェフの作るデザートは絶品で感動した
感情: ポジティブ

例2:
文章: 料理が冷めていて味も薄くて残念だった
感情: ネガティブ

例3:
文章: 味は普通だが値段相応だと思う
感情: ニュートラル

例4:
文章: サービスも料理も素晴らしく最高の体験だった
感情: ポジティブ

例5:
文章: 待ち時間が長すぎて二度と行きたくない
感情: ネガティブ

例6:
文章: 特に印象に残る点はなく可もなく不可もなし
感情: ニュートラル

判定対象:
文章: このレストランの料理は最高に美味しかった
感情:
"""
print("結果: " + generate(prompt))
print()

# Eight-shot（8つの例）
print("=" * 60)
print("Eight-shot（8つの例あり）")
print("=" * 60)
prompt = """
タスク: 感情分析

指示:
以下の文章を読み、その感情を判定してください。
必ず「ポジティブ」「ネガティブ」「ニュートラル」のいずれか1つの単語のみで答えてください。
以下の例を参考にしてください。

例1:
文章: シェフの作るデザートは絶品で感動した
感情: ポジティブ

例2:
文章: 料理が冷めていて味も薄くて残念だった
感情: ネガティブ

例3:
文章: 味は普通だが値段相応だと思う
感情: ニュートラル

例4:
文章: サービスも料理も素晴らしく最高の体験だった
感情: ポジティブ

例5:
文章: 待ち時間が長すぎて二度と行きたくない
感情: ネガティブ

例6:
文章: 特に印象に残る点はなく可もなく不可もなし
感情: ニュートラル

例7:
文章: 新鮮な食材を使った料理がどれも美味しかった
感情: ポジティブ

例8:
文章: 値段が高い割に量が少なくてがっかりした
感情: ネガティブ

判定対象:
文章: このレストランの料理は最高に美味しかった
感情:
"""
print("結果: " + generate(prompt))
print()


